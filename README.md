# Универсальные подходы к контрактам между языками

В мульти-языковых системах (C#, Java, Python, Go и др.) для обмена данными между сервисами используют универсальные форматы описания контрактов. Вот основные подходы:

---

## 1. Protocol Buffers (protobuf, gRPC)
- **Описание:** Контракты описываются в `.proto`-файлах, из которых автоматически генерируется код для разных языков.
- **Плюсы:** Высокая производительность, строгая типизация, поддержка многих языков, бинарный формат, поддержка gRPC.
- **Минусы:** Не все языковые особенности можно выразить, требуется генерация кода.
- **Когда использовать:** Для высокопроизводительных RPC, микросервисов, бинарных протоколов.
- **Пример:**
  ```proto
  message User {
    string id = 1;
    string name = 2;
  }
  ```

---

## 2. OpenAPI/Swagger
- **Описание:** Контракты и REST API описываются в YAML/JSON (OpenAPI спецификация). Генерируются модели и клиенты для разных языков.
- **Плюсы:** Стандарт для REST, поддержка множества языков, автогенерация документации.
- **Минусы:** Не всегда удобно для внутренних DTO, больше подходит для HTTP API.
- **Когда использовать:** Для публичных REST API, когда важна документация.
- **Пример:**
  ```yaml
  components:
    schemas:
      User:
        type: object
        properties:
          id:
            type: string
          name:
            type: string
  ```

---

## 3. JSON Schema
- **Описание:** Структуры данных описываются в JSON Schema, из которых можно генерировать классы/структуры.
- **Плюсы:** Простота, поддержка валидации, легко интегрируется с JSON API.
- **Минусы:** Ограниченная выразительность, нет поддержки RPC.
- **Когда использовать:** Для валидации JSON, простых DTO, интеграции с NoSQL.
- **Пример:**
  ```json
  {
    "type": "object",
    "properties": {
      "id": {"type": "string"},
      "name": {"type": "string"}
    }
  }
  ```

---

## 4. Apache Thrift, FlatBuffers
- **Описание:** Альтернативные IDL-решения, похожие на protobuf, с поддержкой многих языков и бинарных форматов.
- **Плюсы:** Высокая производительность, поддержка RPC, кросс-языковость.
- **Минусы:** Меньше распространены, чем protobuf/gRPC.
- **Когда использовать:** Когда есть опыт с этими технологиями или нужны их уникальные возможности.

---

## 5. Собственная генерация/трансляция
- **Описание:** Использование одного источника (например, C#-классов) и генерация кода для других языков с помощью кастомных генераторов.
- **Плюсы:** Максимальная гибкость, можно учесть все особенности.
- **Минусы:** Высокая стоимость поддержки, риск рассинхронизации.
- **Когда использовать:** Когда стандартные решения не подходят.

---

# Universal RPC Contracts (gRPC + Protobuf)

В этой папке лежат универсальные контракты для обмена между сервисами на C#, Java, Python, Go.

## Как сгенерировать код

### Требования
- [Protocol Buffers Compiler (protoc)](https://github.com/protocolbuffers/protobuf/releases)
- Плагины для нужных языков (см. ниже)

### Генерация для C#
```sh
protoc --csharp_out=../Generated/CSharp --proto_path=. user.proto
```

### Генерация для Java
```sh
protoc --java_out=../Generated/Java --proto_path=. user.proto
```

### Генерация для Python
```sh
protoc --python_out=../Generated/Python --proto_path=. user.proto
```

### Генерация для Go
```sh
protoc --go_out=../Generated/Go --proto_path=. user.proto
```

> Можно добавить другие .proto-файлы и повторить команды.

## Рекомендации
- Храните .proto-файлы как единственный источник правды для контрактов.
- Не редактируйте сгенерированные файлы вручную.
- Используйте CI/CD для автоматической генерации кода.

---

## Быстрая генерация для всех языков через скрипт

В корне проекта есть универсальный bash-скрипт для генерации кода для C#, Java, Python, Go:

```sh
./generate-proto.sh
```

> Перед запуском убедитесь, что у скрипта есть права на исполнение:
> ```sh
> chmod +x generate-proto.sh
> ```
>
> И что protoc установлен и доступен в PATH.

Все сгенерированные файлы появятся в папках:
- `Generated/CSharp`
- `Generated/Java`
- `Generated/Python`
- `Generated/Go`

---

## Использование скрипта на Windows

Скрипт `generate-proto.sh` написан для bash-окружения (Linux, macOS, WSL, Git Bash). На Windows его можно использовать так:

### 1. Через WSL (Windows Subsystem for Linux)
- Установите WSL и дистрибутив Linux из Microsoft Store.
- Откройте WSL, перейдите в папку проекта и выполните:
  ```sh
  chmod +x generate-proto.sh
  ./generate-proto.sh
  ```

### 2. Через Git Bash
- Установите [Git for Windows](https://gitforwindows.org/).
- Откройте Git Bash, перейдите в папку проекта:
  ```sh
  chmod +x generate-proto.sh
  ./generate-proto.sh
  ```

### 3. Через PowerShell (альтернатива)
- Если bash недоступен, используйте PowerShell-скрипт (например, `generate-proto-csharp.ps1`) для генерации только C#-кода.
- Для генерации для всех языков можно написать аналогичный PowerShell-скрипт.

> Убедитесь, что `protoc` установлен и доступен в PATH вашей bash- или PowerShell-сессии.

--- 